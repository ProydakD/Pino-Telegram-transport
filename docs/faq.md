# FAQ

## Почему бот ничего не отправляет?

- Проверьте, что бот добавлен в чат и получил права отправки.
- Убедитесь, что `botToken` и `chatId` заданы, иначе транспорт перейдёт в режим no-op и выведет предупреждение.
- Включите `onDeliveryError`, чтобы увидеть ответ Telegram (`error.response`).

## Как отправлять сообщения в несколько чатов?

- Передайте массив `chatId`: `chatId: ['@channel', 123456789]`.
- Используйте объекты `{ chatId, threadId }`, чтобы адресовать конкретную тему супергруппы.
- Настройте `minDelayBetweenMessages`, чтобы не упереться в лимиты Telegram.

## Откуда берётся DataCloneError?

- Pino копирует опции транспорта в воркер. Функции (`formatMessage`, `send`, `onDeliveryError`) нельзя сериализовать.
- Отключите воркер: `worker: { enabled: false }`, либо создайте транспорт вручную и передайте поток в `pino`.

## Как отправить вложение больше 1024 символов в подписи?

- Telegram ограничивает подпись медиа 1024 символами — укоротите `caption` или вынесите текст в `sendMessage`.
- Храните ссылки на большие файлы в Object Storage и передавайте URL вместо двоичных данных.
- Используйте `document` для файлов, требующих имени и типа.

## Можно ли протестировать транспорт без запроса к Telegram?

- Передайте опцию `send`, которая сохраняет payload в памяти или пишет его в моковый HTTP-сервер.
- Используйте Vitest и `vi.useFakeTimers()` для проверки задержек и ретраев.
- См. `tests/transport.test.ts` и `examples/custom-send.ts`.

## Как понять, что я упираюсь в rate limit?

- Telegram возвращает `429` и поле `retry_after`.
- Транспорт автоматически ждёт указанное время, но увеличьте `minDelayBetweenMessages`, если ситуация повторяется.
- Добавьте метрики в `onDeliveryError`, чтобы отслеживать частоту ограничений.
