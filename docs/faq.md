# FAQ и устранение неполадок

## Почему появляется `DataCloneError`?

Pino запускает транспорт в воркере и клонирует опции. Функции (`formatMessage`, `send`) клонировать нельзя, поэтому возникает ошибка. Решения:

- создать транспорт напрямую и передавать поток в `pino({}, stream)`;
- или отключить воркер: `worker: { enabled: false }`.

## Как полностью отключить Extras?

Передайте `includeExtras: false`. Секция не появится даже при наличии дополнительных полей.

## Как выбрать поля для Extras?

Используйте `extraKeys: ['requestId', 'userId']`. Зарезервированные поля (`level`, `time`, `msg`, `context`, `err`) игнорируются автоматически.

## Можно ли кастомизировать заголовки?

Да, опция `headings` позволяет настроить подписи.

```ts
headings: {
  time: 'Время',
  context: 'Контекст',
  extras: 'Дополнительно',
}
```

## Что делать при лимитах Telegram?

- Увеличьте `minDelayBetweenMessages` (например, до `500` мс).
- Настройте `retryAttempts` и `retryInitialDelay`, чтобы дать боту больше времени на восстановление после 429.
- Раснесите сообщения по нескольким ботам или чатам.
- Обрабатывайте коды ошибок (429, 5xx) в `onDeliveryError`, если нужно уведомить операторов.

## Как тестировать без реального Telegram?

Переопределите `send`, как в примере `custom-send.ts`, и сохраняйте payload в память/файлы. Тесты проекта используют именно такой подход.

## Почему сообщение обрезано?

Telegram ограничивает длину. Транспорт обрезает текст до `maxMessageLength` (по умолчанию 4096) и добавляет уведомление «Сообщение было сокращено». Измените лимит или улучшите форматтер.

## Можно ли отправлять вложения/файлы?

Текущая реализация работает только с текстом (`sendMessage`).

## Как логировать ошибки доставки?

Укажите `onDeliveryError`, логируйте или повторяйте отправку. Без хендлера транспорт пишет сообщения в stderr.

## Как работать с несколькими ботами?

Создайте несколько экземпляров транспорта с разными `botToken`/`chatId` или распределите сообщения вручную — очередь и rate limit привязаны к каждому экземпляру.

## Почему я не вижу контекст?

Проверьте, что ключ контекста попадает в `contextKeys`. Если ключ другой (`metadata`), добавьте его в массив. Также убедитесь, что `includeContext` не отключён.

## Что будет, если забыть задать botToken или chatId?

Транспорт выводит предупреждение `[pino-telegram] transport disabled`, возвращая no-op поток, чтобы не ломать процесс. Заполните параметры и перезапустите службу для возобновления отправки.
